<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for packages/ebnf-parser/tests/ebnf.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="..\..\..\prettify.css" />
    <link rel="stylesheet" href="..\..\..\base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(..\..\..\sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="..\..\..\index.html">All files</a> / <a href="index.html">packages/ebnf-parser/tests</a> ebnf.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>27/27</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">75% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>3/4</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>11/11</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>27/27</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150</td><td class="line-coverage quiet"><span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">14x</span>
<span class="cline-any cline-yes">14x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">14x</span>
<span class="cline-any cline-yes">14x</span>
<span class="cline-any cline-yes">16x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">14x</span>
<span class="cline-any cline-yes">14x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">14x</span>
<span class="cline-any cline-yes">14x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">30x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">var assert = require("chai").assert;
var bnf = require("../dist/ebnf-parser-cjs-es5");
var ebnf = bnf.ebnf_parser;
var Jison = require('../../../../jison/');  // jison-gho
var Parser = Jison.Parser;
&nbsp;
function testParse(top, strings) {
    return function() {
        var grammar = {
            "lex": {
                "rules": [
                    ["\\s+", ''],
                    ["[A-Za-z]+", "return 'word';"],
                    [",", "return ',';"],
                    ["\"'", "return \"\\\"'\";"],
                    ["'", "return \"'\";"],
                    ['"', "return '\"';"],
                    ["$", "return 'EOF';"]
                ]
            },
            "start": "top",
            "ebnf": {"top": [top]},
            "bnf": ebnf.transform({"top": [top]})
        };
        strings = (typeof(strings) === 'string' ? [strings] : strings);
        strings.forEach(function(string) {
            assert.ok(new Parser(grammar).parse(string));
        });
    };
}
&nbsp;
function testBadParse(top, strings) {
    return function() {
        var grammar = {
            "lex": {
                "rules": [
                    ["\\s+", ''],
                    ["[A-Za-z]+", "return 'word';"],
                    [",", "return ',';"],
                    ["$", "return 'EOF';"]
                ]
            },
            "start": "top",
            "ebnf": {"top": [top]}
        };
        strings = (typeof(strings) === 'string' ? [strings] : <span class="branch-1 cbranch-no" title="branch not covered" >strings)</span>;
        strings.forEach(function(string) {
            assert.throws(function () {
                new Parser(grammar).parse(string);
            });
        });
    };
}
&nbsp;
function testAlias(top, obj, str) {
    return function() {
        var grammar = {
            "lex": {
                "rules": [
                    ["\\s+", ''],
                    ["[A-Za-z]+", "return 'word';"],
                    [",", "return ',';"],
                    ["$", "return 'EOF';"]
                ]
            },
            "start": "top",
            "ebnf": {"top": [top]},
            "bnf": ebnf.transform({"top": [top]})
        };
        assert.deepEqual(grammar['bnf'], obj);
        assert.ok(new Parser(grammar).parse(str));
    };
}
&nbsp;
var tests = {
    "test idempotent transform": function() {
        var first = {
            "nodelist": [["", "$$ = [];"], ["nodelist node", "$1.push($2);"]]
        };
        var second = ebnf.transform(JSON.parse(JSON.stringify(first)));
        assert.deepEqual(second, first);
    },
    "test repeat (*) on empty string": testParse("word* EOF", ""),
    "test repeat (*) on single word": testParse("word* EOF", "oneword"),
    "test repeat (*) on multiple words": testParse("word* EOF", "multiple words"),
    "test repeat (+) on empty string": testBadParse("word+ EOF", ""),
    "test repeat (+) on single word": testParse("word+ EOF", "oneword"),
    "test repeat (+) on multiple words": testParse("word+ EOF", "multiple words"),
    "test option (?) on empty string": testParse("word? EOF", ""),
    "test option (?) on single word": testParse("word? EOF", "oneword"),
//    "test single quote (') tokens": testParse("'\\'' EOF", "'"),
    "test single quote (') tokens (alt.)": testParse("\"'\" EOF", "'"),
//    "test double quote (\") tokens": testParse("\"\\\"\" EOF", "\""),
    "test double quote (\") tokens (alt.)": testParse("'\"' EOF", "\""),
//    "test quoted tokens (edge case #1)": testParse("'\"\\'' EOF", "\"'"),       // a weird 'token' consisting of a single AND a double-quote: either way, one of them will end up being escaped! 
    "test quoted tokens (edge case #2)": testParse('"\\"\'" EOF', "\"'"),       // a weird 'token' consisting of a single AND a double-quote: either way, one of them will end up being escaped! 
    "test group () on simple phrase": testParse("(word word) EOF", "two words"),
    "test group () with multiple options on first option": testParse("((word word) | word) EOF", "hi there"),
    "test group () with multiple options on second option": testParse("((word word) | word) EOF", "hi"),
    "test complex expression ( *, ?, () )": testParse("(word (',' word)*)? EOF ", ["", "hi", "hi, there"]),
    "test named repeat (*)": testAlias("word*[bob] EOF",
        { top: [ 'bob EOF' ],
        bob: [ [ '', '$$ = [];' ], [ 'bob word', '$1.push($2);\n$$ = $1;' ] ] }, "word"),
    "test named repeat (+)": testAlias("word+[bob] EOF",
        { top: [ 'bob EOF' ],
        bob: [ [ 'word', '$$ = [$1];' ], [ 'bob word', '$1.push($2);\n$$ = $1;' ] ] }, "wordy word"),
    "test named group ()": testAlias("word[alice] (',' word)*[bob] EOF",
        {"top":["word[alice] bob EOF"],"bob":[["","$$ = [];"],["bob ',' word","$1.push([$2, $3]);\n$$ = $1;"]]},
        "one, two"),
    "test nested named groups ()": testAlias("word[alice] (',' (word word)*[uncle] )*[bob] EOF",
        {"top":["word[alice] bob EOF"],"bob":[["","$$ = [];"],["bob ',' uncle","$1.push([$2, $3]);\n$$ = $1;"]],"uncle":[["","$$ = [];"],["uncle word word","$1.push([$2, $3]);\n$$ = $1;"]]},
        "one, two three four five"),
    "test named group () without wildcard operator": testAlias("word[alice] (',' word)[bob] EOF",
        {"top":["word[alice] bob EOF"],"bob":[["',' word","$$ = [$1, $2];"]]},
        "one, two"),
    "test unnamed group () without wildcard operator": testAlias("word[alice] (',' word) EOF",
        {"top":["word[alice] ',' word EOF"]},
        "one, two"),
    "test nested unnamed groups () without wildcard operator #1": testAlias("word[alice] ( (',' word) ) EOF",
        {"top":["word[alice] ',' word EOF"]},
        "one, two"),
    "test nested unnamed groups () without wildcard operator #2": testAlias("word[alice] ( ',' ( word word) ) EOF",
        {"top":["word[alice] ',' word word EOF"]},
        "one, two three"),
    "test nested named groups () mix #1": testAlias("word[alice] (',' (word word)[uncle] )*[bob] EOF",
        {"top":["word[alice] bob EOF"],"bob":[["","$$ = [];"],["bob ',' uncle","$1.push([$2, $3]);\n$$ = $1;"]],"uncle":[["word word","$$ = [$1, $2];"]]},
        "one, two three, four five"),
    "test nested named groups () mix #2": testAlias("word[alice] (',' (word word) )*[bob] EOF",
        {"top":["word[alice] bob EOF"],"bob":[["","$$ = [];"],["bob ',' word word","$1.push([$2, $3, $4]);\n$$ = $1;"]]},
        "one, two three, four five"),
    "test nested named groups () mix #3": testAlias("word[alice] (',' (word word) (word word) )*[bob] EOF",
        {"top":["word[alice] bob EOF"],"bob":[["","$$ = [];"],["bob ',' word word word word","$1.push([$2, $3, $4, $5, $6]);\n$$ = $1;"]]},
        "one, two three four five, six seven eight nine"),
    "test nested named groups () mix #4": testAlias("word[alice] (',' (word)[uncle] )*[bob] EOF",
        {"top":["word[alice] bob EOF"],"bob":[["","$$ = [];"],["bob ',' uncle","$1.push([$2, $3]);\n$$ = $1;"]],"uncle":[["word","$$ = $1;"]]},
        "one, two, three, four"),
    "test named option (?)": testAlias("word[alex] word?[bob] EOF", { top: [ 'word[alex] bob EOF' ], bob: [['', '$$ = undefined;'], ['word', '$$ = $1;']] }, "oneor two"),
    "test named complex expression (())": testAlias("word[alpha] (word[alex] (word[bob] word[carol] ',')+[david] word ',')*[enoch] EOF",
        {"top":["word[alpha] enoch EOF"],"david":[["word[bob] word[carol] ','","$$ = [[$1, $2, $3]];"],["david word[bob] word[carol] ','","$1.push([$2, $3, $4]);\n$$ = $1;"]],
        "enoch":[["","$$ = [];"],["enoch word[alex] david word ','","$1.push([$2, $3, $4, $5]);\n$$ = $1;"]]},
        "one two three four, five,"
    )
};
&nbsp;
describe("EBNF", function () {
    for (var test in tests) {
        it(test, tests[test]);
    }
});
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="https://istanbul.js.org/" target="_blank">istanbul</a> at Mon Dec 25 2017 04:04:12 GMT+0100 (W. Europe Standard Time)
</div>
</div>
<script src="..\..\..\prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="..\..\..\sorter.js"></script>
</body>
</html>
